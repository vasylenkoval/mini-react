var y=[];var k=Symbol("propsCompareFn"),H="TEXT";function K(e,t=[]){for(let n of e){let o=typeof n;if(o==="object"&&n){Array.isArray(n)?K(n,t):t.push(n);continue}(o==="string"||o==="number")&&t.push({type:H,props:{nodeValue:n},children:y,key:null})}return t.length?t:y}function c(e,t,...n){let o=t??{},r=null;return n.length>0&&(r=K(n),o.children=r),{type:e,props:o,children:r,key:o.key!==void 0?o.key:null}}function pe(e){return e===H?document.createTextNode(""):document.createElement(e)}var fe="children",me="on",X=e=>e.startsWith(me),Y=e=>e!==fe&&!X(e),$=e=>e.toLowerCase().substring(2),z=e=>e==="className"?"class":e,he=(e,t)=>e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t;function ye(e,t,n,o){if(t.nodeType===3){t.nodeValue!==n.nodeValue&&(t.nodeValue=n.nodeValue);return}let r=t;if(o){for(let l in o)if(!(l in n))if(Y(l)){let s=z(l);r.removeAttribute(s)}else X(l)&&r.removeEventListener($(l),o[l])}for(let l in n){if(o&&n[l]===o[l])continue;let s=n[l];if(Y(l)&&typeof s=="string"){let i=z(l);he(i,r)?r[i]=s:r.setAttribute(i,s)}else if(X(l)){let i=$(l);o&&o[l]&&r.removeEventListener(i,o[l]),r.addEventListener(i,n[l])}}r.__fiberRef=e}var J=globalThis.Node?.prototype,be=J?.insertBefore,ge=J?.removeChild,Ee=J?.appendChild;function Te(e,t){ge.call(e,t)}function ke(e,t){Ee.call(e,t)}function ve(e,t){e.replaceWith(t)}function Fe(e,t,n){be.call(e,t,n)}var Q={createNode:pe,addProps:ye,removeChild:Te,appendChild:ke,replaceWith:ve,insertBefore:Fe};var m={hooks:[],notifyOnStateChange:()=>{},scheduleEffect:()=>{}},T=-1;function G(e,t,n){for(let o of e)o.type===0&&o.pending&&(o.value=o.pending.value,o.pending=void 0);m.hooks=e,m.notifyOnStateChange=t,m.scheduleEffect=n,T=-1}function Ce(e){T++;let t=m.hooks[T];if(t)return t.notify=m.notifyOnStateChange,[t.value,t.setter];let n={type:0,notify:m.notifyOnStateChange,value:typeof e=="function"?e():e,setter(o){let r=n.pending?n.pending.value:n.value,l=typeof o=="function"?o:void 0,s=l?l(r):o;s!==r&&(n.pending={value:s},n.notify())}};return m.hooks.push(n),[n.value,n.setter]}function Z(e){let t;for(let n of e)n.type===1&&n.cleanup&&(t??(t=[])).push(n.cleanup);return t}function Ne(e,t){return!e||!t?!1:e.length===t.length&&(e.length===0||e.every((n,o)=>n===t[o]))}function _(e,t){T++;let n=m.hooks[T];if(n)return Ne(t,n.deps)||(n.deps=t,n.value=e()),n.value;let o={type:3,deps:t,value:e()};return m.hooks.push(o),o.value}function Se(e){T++;let t=m.hooks[T];if(t)return t.value;let n={type:2,value:{current:e}};return m.hooks.push(n),n.value}function j(e,t,n){let o=Se({dispatch:void 0,initState:n?n(t):t}),[r,l]=Ce(o.current.initState);if(o.current.dispatch)return[r,o.current.dispatch];function s(i){l(b=>e(b,i))}return o.current.dispatch=s,[r,s]}function S(e){return e(Re)}function Re(){return 100}var ne="root",v,w=[],d,Ae,R=[],x=[],A=[],O=[],g=Q,oe=(e,t)=>!1;function D(){let e={key:null,children:y},t={parent:null,child:null,sibling:null,type:"",props:e,effectTag:0,old:null,isOld:!1,dom:null,stateNode:null,shouldPlace:!1,version:0,childElements:y,fromElement:{type:"",props:e,children:y,key:null},propsCompareFn:oe};return t.stateNode={current:t,hooks:[]},t}function re(e,t,n){n&&(g=n);let o=D();o.type=ne,o.dom=e,o.props={key:null,children:[t]},o.fromElement={type:"div",props:o.props,children:[t],key:null},d=o,v=o,S(P)}function Me(e){w.includes(e)||(w.push(e),S(P))}function xe(e){return e.shouldPlace||e.effectTag!==3}function Oe(){for(let e of R)Pe(e);if(R=[],d){let e=d;for(;e;)Le(e),e=ie(e,d,xe,e.effectTag===3);for(let t=O.length-1;t>=0;t--)O[t]();if(O.splice(0),d.type===ne)Ae=d;else{let t=d.old,n=d.parent,o=n.child;if(o===t)n.child=d;else for(;o;){if(o.sibling===t){o.sibling=d;break}o=o.sibling}}}d=null;for(let e=A.length-1;e>=0;e--)A[e]();A.splice(0);for(let e=x.length-1;e>=0;e--)x[e]();x.splice(0)}function I(e){return!!e.dom}function we(e){return typeof e.type!="string"}function Pe(e){let t=e.dom??L(e,e,I)?.dom;t&&t.parentNode&&g.removeChild(t.parentNode,t);let n=e;for(;n;){if(n.stateNode.hooks.length){let o=Z(n.stateNode.hooks);o&&A.push(...o.reverse())}n=L(n,e,we)}e.effectTag=2,e.isOld=!0,e.old=null,e.child=null,e.sibling=null,e.parent=null,e.dom=null,e.stateNode=null,e.childElements=y}function Le(e){if(e.shouldPlace){let n=e.dom??L(e,e,I)?.dom;n&&O.push(()=>{let o=e.sibling?e.sibling?.dom??L(e.sibling,e,I)?.dom??null:null;n.nextSibling!=o&&g.insertBefore(n.parentNode,n,o)})}if(!(e.dom&&e.parent)||e.effectTag===3)return;let t=e.parent;for(;!t.dom;)t=t.parent;if(e.effectTag===1&&g.addProps(e,e.dom,e.props,e.old?.props||null),e.effectTag===0){let n=t.dom,o=e.dom;g.appendChild(n,o)}}function le(){if(!w.length)return null;let e=w.shift();if(e.isOld)return le();let t=D();t.type=e.type,t.parent=e.parent,t.child=e.child,t.sibling=e.sibling,t.old=e,t.isOld=!1,t.dom=e.dom;let n=e.stateNode;return t.stateNode=n,n.current=t,t.effectTag=1,t.shouldPlace=!1,t.props=e.props,t.version=e.version+1,t.childElements=e.childElements,t.fromElement=e.fromElement,t.propsCompareFn=e.propsCompareFn,e.old=null,e.isOld=!0,t}function P(e){let t=!1;for(;v&&!t;)v=Xe(v),t=e()<1;!v&&d&&Oe();let n=le();if(n){d=n,v=d,S(P);return}d&&S(P)}function De(e){k in e.type&&e.type[k]&&(e.propsCompareFn=e.type[k]);let t,n,o=e.stateNode;G(o.hooks,function(){Me(o.current)},function(s,i){(t??(t=[])).push(s),i&&(n??(n=[])).push(i)});let r=e.type(e.props);e.childElements=[r],t&&x.push(...t.reverse()),n&&A.push(...n.reverse())}function He(e){e.dom||(e.dom=g.createNode(e.type),g.addProps(e,e.dom,e.props,null)),e.childElements=e.fromElement.children??y}function Xe(e){return typeof e.type=="string"&&He(e),typeof e.type=="function"&&De(e),Ie(e,e.childElements),ie(e,d,Je)}function Je(e){return e.effectTag!==3}function _e(){return!0}function ie(e,t,n=_e,o=!1){if(!o&&e.child&&n(e.child))return e.child;let r=o?e:e.child??e;for(;r&&r!==t;){let l=r.sibling;for(;l;){if(n(l))return l;l=l.sibling}r=r.parent}return null}function ee(e,t){let n=e;if(n.child)return n.child;for(;n&&n!==t;){let o=n.sibling;if(o)return o;n=n.parent}return null}function L(e,t,n){if(!e)return null;let o=ee(e,t);for(;o;){if(n(o))return o;o=ee(o,t)}return null}function Ie(e,t){if(!t.length&&e.dom&&e.parent&&e.old&&e.old.child){let a=e.old;R.push(a),e.old=null,e.effectTag=0,e.childElements=y,e.child=null,e.dom=g.createNode(e.type),g.addProps(e,e.dom,e.props,null);return}let n=e.old?.child??null,o=null,r=new Map,l=[],s=n,i=0;for(;s;){let a=s.fromElement.key??i;r.set(a,{fiber:s,oldListIdx:i}),l.push(s),s=s.sibling,i++}let b=!!n,h=[];for(let a=0;a<t.length;a++){let E=t[a],V=E.key??a,q=r.get(V),u=null;if(q){let{fiber:f,oldListIdx:ue}=q;if(r.delete(V),f.type===E.type){if(u=Ue(E,e,f),h.push({fiber:u,oldListIdx:ue}),f.fromElement===E||typeof E.type!="string"&&u.propsCompareFn?.(f.props,E.props)){u.effectTag=3,u.child=f.child;let M=f.child;for(;M;)M.parent=u,M=M.sibling}f.old=null,f.isOld=!0,f.sibling=null,f.parent=null}else R.push(f),u=te(E,e),u.shouldPlace=b}else u=te(E,e),u.shouldPlace=b;u&&(a===0?e.child=u:o.sibling=u,o=u)}if(r.forEach(a=>{R.push(a.fiber)}),!b)return;let C=h.map(a=>a.oldListIdx),N=We(C);for(let a of N)h[a].fiber.shouldPlace=!0}function te(e,t){let n=D();return n.type=e.type,n.parent=t,n.props=e.props,n.fromElement=e,n.effectTag=0,typeof e.type=="string"&&(n.propsCompareFn=oe),n}function Ue(e,t,n){let o=D();o.type=e.type,o.parent=t,o.old=n,o.dom=n.dom,o.effectTag=1,o.props=e.props,o.version=n.version+1,o.fromElement=e,o.propsCompareFn=n.propsCompareFn;let r=n.stateNode;return r.current=o,o.stateNode=r,o}function We(e){let t=e.length,n=new Uint32Array(t),o=[];for(let i=0;i<t;i++){let b=e[i],h=0,C=o.length;for(;h<C;){let N=h+C>>>1;o[N]<b?h=N+1:C=N}h===o.length?o.push(b):o[h]=b,n[i]=h+1}let r=new Uint8Array(t),l=o.length;for(let i=t-1;i>=0&&l>0;i--)n[i]===l&&(r[i]=1,l--);let s=[];for(let i=0;i<t;i++)r[i]||s.push(i);return s}function Be(e,t){if(e===t)return!0;let n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(let r=0;r<n.length;r++){let l=n[r];if(e[l]!==t[l])return!1}return!0}function U(e,t=Be){function n(o){return e(o)}return n[k]=t,n}var W=e=>Math.round(Math.random()*1e3)%e,se=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],ce=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],de=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"],Ve=1,B=e=>{let t=new Array(e);for(let n=0;n<e;n++)t[n]={id:Ve++,label:`${se[W(se.length)]} ${ce[W(ce.length)]} ${de[W(de.length)]}`};return t},qe={data:[],selected:0},Ke=(e,t)=>{let{data:n,selected:o}=e;switch(t.type){case"RUN":return{data:B(1e3),selected:0};case"RUN_LOTS":return{data:B(1e4),selected:0};case"ADD":return{data:n.concat(B(1e3)),selected:o};case"UPDATE":{let l=n.slice(0);for(let s=0;s<l.length;s+=10){let i=l[s];l[s]={id:i.id,label:i.label+" !!!"}}return{data:l,selected:o}}case"CLEAR":return{data:[],selected:0};case"SWAP_ROWS":let r=[...n];if(n.length>998){let l=r[1],s=r[998];r[1]=s,r[998]=l}return{data:r,selected:o};case"REMOVE":{let l=n.findIndex(s=>s.id===t.id);return{data:[...n.slice(0,l),...n.slice(l+1)],selected:o}}case"SELECT":return{data:n,selected:t.id};default:return e}},Ye=U(({selected:e,item:t,dispatch:n})=>c("tr",{className:e?"danger":""},c("td",{className:"col-md-1"},t.id),c("td",{className:"col-md-4"},c("a",{onClick:_(()=>()=>n({type:"SELECT",id:t.id}),[])},t.label)),c("td",{className:"col-md-1"},c("a",{onClick:_(()=>()=>n({type:"REMOVE",id:t.id}),[])},c("span",{className:"glyphicon glyphicon-remove","aria-hidden":"true"}))),c("td",{className:"col-md-6"})),(e,t)=>e.selected===t.selected&&e.item===t.item),F=({id:e,cb:t,title:n})=>c("div",{className:"col-sm-6 smallpad"},c("button",{type:"button",className:"btn btn-primary btn-block",id:e,onClick:t},n)),$e=U(({dispatch:e})=>c("div",{className:"jumbotron"},c("div",{className:"row"},c("div",{className:"col-md-6"},c("h1",null,"React Hooks keyed")),c("div",{className:"col-md-6"},c("div",{className:"row"},c(F,{id:"run",title:"Create 1,000 rows",cb:()=>e({type:"RUN"})}),c(F,{id:"runlots",title:"Create 10,000 rows",cb:()=>e({type:"RUN_LOTS"})}),c(F,{id:"add",title:"Append 1,000 rows",cb:()=>e({type:"ADD"})}),c(F,{id:"update",title:"Update every 10th row",cb:()=>e({type:"UPDATE"})}),c(F,{id:"clear",title:"Clear",cb:()=>e({type:"CLEAR"})}),c(F,{id:"swaprows",title:"Swap Rows",cb:()=>e({type:"SWAP_ROWS"})}))))),()=>!0),ae=({dispatchRef:e})=>{let[{data:t,selected:n},o]=j(Ke,qe);return e.current=o,c("div",{className:"container"},c($e,{dispatch:o}),c("table",{className:"table table-hover table-striped test-data"},c("tbody",null,t.map(r=>c(Ye,{key:r.id,item:r,selected:n===r.id,dispatch:o})))),c("span",{className:"preloadicon glyphicon glyphicon-remove","aria-hidden":"true"}))};var ze={},Qe={createNode:()=>ze,addProps:()=>{},removeChild:()=>{},replaceWith:()=>{},appendChild:()=>{},insertBefore:()=>{}},p={current:null},Ge=performance.now();re(void 0,c(ae,{dispatchRef:p}),Qe);if(!p.current)throw new Error("dispatch did not bind");p.current({type:"RUN_LOTS"});p.current({type:"RUN_LOTS"});p.current({type:"RUN_LOTS"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"REMOVE",id:1});p.current({type:"REMOVE",id:2});p.current({type:"REMOVE",id:3});p.current({type:"CLEAR"});var Ze=performance.now();console.log(`bench-1k: took ${Ze-Ge} ms`);
