var h=[];var b=Symbol("propsCompareFn"),w="TEXT";function W(e,t=[]){for(let n of e){let o=typeof n;if(o==="object"&&n){Array.isArray(n)?W(n,t):t.push(n);continue}(o==="string"||o==="number")&&t.push({type:w,props:{nodeValue:n},children:h,key:null})}return t.length?t:h}function i(e,t,...n){let o=t??{},l=null;return n.length>0&&(l=W(n),o.children=l),{type:e,props:o,children:l,key:o.key!==void 0?o.key:null}}function ce(e){return e===w?document.createTextNode(""):document.createElement(e)}var de="children",ae="on",O=e=>e.startsWith(ae),B=e=>e!==de&&!O(e),V=e=>e.toLowerCase().substring(2),q=e=>e==="className"?"class":e,pe=(e,t)=>e!="width"&&e!="height"&&e!="href"&&e!="list"&&e!="form"&&e!="tabIndex"&&e!="download"&&e!="rowSpan"&&e!="colSpan"&&e!="role"&&e!="popover"&&e in t;function ue(e,t,n,o){if(t.nodeType===3){t.nodeValue!==n.nodeValue&&(t.nodeValue=n.nodeValue);return}let l=t;if(o){for(let r in o)if(!(r in n))if(B(r)){let s=q(r);l.removeAttribute(s)}else O(r)&&l.removeEventListener(V(r),o[r])}for(let r in n){if(o&&n[r]===o[r])continue;let s=n[r];if(B(r)&&typeof s=="string"){let c=q(r);pe(c,l)?l[c]=s:l.setAttribute(c,s)}else if(O(r)){let c=V(r);o&&o[r]&&l.removeEventListener(c,o[r]),l.addEventListener(c,n[r])}}l.__fiberRef=e}var D=globalThis.Node?.prototype,fe=D?.insertBefore,me=D?.removeChild,he=D?.appendChild;function ye(e,t){me.call(e,t)}function ge(e,t){he.call(e,t)}function Ee(e,t){e.replaceWith(t)}function be(e,t,n){fe.call(e,t,n)}var K={createNode:ce,addProps:ue,removeChild:ye,appendChild:ge,replaceWith:Ee,insertBefore:be};var m={hooks:[],notifyOnStateChange:()=>{},scheduleEffect:()=>{}},E=-1;function Y(e,t,n){for(let o of e)o.type===0&&o.pending&&(o.value=o.pending.value,o.pending=void 0);m.hooks=e,m.notifyOnStateChange=t,m.scheduleEffect=n,E=-1}function Te(e){E++;let t=m.hooks[E];if(t)return t.notify=m.notifyOnStateChange,[t.value,t.setter];let n={type:0,notify:m.notifyOnStateChange,value:typeof e=="function"?e():e,setter(o){let l=n.pending?n.pending.value:n.value,r=typeof o=="function"?o:void 0,s=r?r(l):o;s!==l&&(n.pending={value:s},n.notify())}};return m.hooks.push(n),[n.value,n.setter]}function $(e){let t;for(let n of e)n.type===1&&n.cleanup&&(t??(t=[])).push(n.cleanup);return t}function ke(e,t){return!e||!t?!1:e.length===t.length&&(e.length===0||e.every((n,o)=>n===t[o]))}function H(e,t){E++;let n=m.hooks[E];if(n)return ke(t,n.deps)||(n.deps=t,n.value=e()),n.value;let o={type:3,deps:t,value:e()};return m.hooks.push(o),o.value}function ve(e){E++;let t=m.hooks[E];if(t)return t.value;let n={type:2,value:{current:e}};return m.hooks.push(n),n.value}function z(e,t,n){let o=ve({dispatch:void 0,initState:n?n(t):t}),[l,r]=Te(o.current.initState);if(o.current.dispatch)return[l,o.current.dispatch];function s(c){r(a=>e(a,c))}return o.current.dispatch=s,[l,s]}function v(e){return e(Ce)}function Ce(){return 100}var Z="root",T,A=[],d,Fe,C=[],S=[],F=[],R=[],y=K,j=(e,t)=>!1;function M(){let e={key:null,children:h},t={parent:null,child:null,sibling:null,type:"",props:e,effectTag:0,old:null,isOld:!1,dom:null,stateNode:null,didChangePos:!1,version:0,childElements:h,fromElement:{type:"",props:e,children:h,key:null},propsCompareFn:j};return t.stateNode={current:t,hooks:[]},t}function ee(e,t,n){n&&(y=n);let o=M();o.type=Z,o.dom=e,o.props={key:null,children:[t]},o.fromElement={type:"div",props:o.props,children:[t],key:null},d=o,T=o,v(x)}function Ne(e){A.includes(e)||(A.push(e),v(x))}function Se(e){return e.didChangePos||e.effectTag!==3}function Re(){for(let e of C)xe(e);if(C=[],d){let e=d;for(;e;)Pe(e),e=ne(e,d,Se,e.effectTag===3);for(let t=R.length-1;t>=0;t--)R[t]();if(R.splice(0),d.type===Z)Fe=d;else{let t=d.old,n=d.parent,o=n.child;if(o===t)n.child=d;else for(;o;){if(o.sibling===t){o.sibling=d;break}o=o.sibling}}}d=null;for(let e=F.length-1;e>=0;e--)F[e]();F.splice(0);for(let e=S.length-1;e>=0;e--)S[e]();S.splice(0)}function X(e){return!!e.dom}function Ae(e){return typeof e.type!="string"}function xe(e){let t=e.dom??P(e,e,X)?.dom;t&&t.parentNode&&y.removeChild(t.parentNode,t);let n=e;for(;n;){if(n.stateNode.hooks.length){let o=$(n.stateNode.hooks);o&&F.push(...o.reverse())}n=P(n,e,Ae)}e.effectTag=2,e.isOld=!0,e.old=null,e.child=null,e.sibling=null,e.parent=null,e.dom=null,e.stateNode=null,e.childElements=h}function Pe(e){if(e.didChangePos){let n=e.dom??P(e,e,X)?.dom,o=e.sibling?e.sibling?.dom??P(e.sibling,e,X)?.dom??null:null;n&&R.push(()=>{n.nextSibling!==o&&y.insertBefore(n.parentNode,n,o)})}if(!(e.dom&&e.parent)||e.effectTag===3)return;let t=e.parent;for(;!t.dom;)t=t.parent;if(e.effectTag===1&&y.addProps(e,e.dom,e.props,e.old?.props||null),e.effectTag===0){let n=t.dom,o=e.dom;y.appendChild(n,o)}}function te(){if(!A.length)return null;let e=A.shift();if(e.isOld)return te();let t=M();t.type=e.type,t.parent=e.parent,t.child=e.child,t.sibling=e.sibling,t.old=e,t.isOld=!1,t.dom=e.dom;let n=e.stateNode;return t.stateNode=n,n.current=t,t.effectTag=1,t.didChangePos=!1,t.props=e.props,t.version=e.version+1,t.childElements=e.childElements,t.fromElement=e.fromElement,t.propsCompareFn=e.propsCompareFn,e.old=null,e.isOld=!0,t}function x(e){let t=!1;for(;T&&!t;)T=Oe(T),t=e()<1;!T&&d&&Re();let n=te();if(n){d=n,T=d,v(x);return}d&&v(x)}function Me(e){b in e.type&&e.type[b]&&(e.propsCompareFn=e.type[b]);let t,n,o=e.stateNode;Y(o.hooks,function(){Ne(o.current)},function(s,c){(t??(t=[])).push(s),c&&(n??(n=[])).push(c)});let l=e.type(e.props);e.childElements=[l],t&&S.push(...t.reverse()),n&&F.push(...n.reverse())}function we(e){e.dom||(e.dom=y.createNode(e.type),y.addProps(e,e.dom,e.props,null)),e.childElements=e.fromElement.children??h}function Oe(e){return typeof e.type=="string"&&we(e),typeof e.type=="function"&&Me(e),Xe(e,e.childElements),ne(e,d,De)}function De(e){return e.effectTag!==3}function He(){return!0}function ne(e,t,n=He,o=!1){if(!o&&e.child&&n(e.child))return e.child;let l=o?e:e.child??e;for(;l&&l!==t;){let r=l.sibling;for(;r;){if(n(r))return r;r=r.sibling}l=l.parent}return null}function Q(e,t){let n=e;if(n.child)return n.child;for(;n&&n!==t;){let o=n.sibling;if(o)return o;n=n.parent}return null}function P(e,t,n){if(!e)return null;let o=Q(e,t);for(;o;){if(n(o))return o;o=Q(o,t)}return null}function Xe(e,t){if(!t.length&&e.dom&&e.parent&&e.old&&e.old.child){let a=e.old;C.push(a),e.old=null,e.effectTag=0,e.childElements=h,e.child=null,e.dom=y.createNode(e.type),y.addProps(e,e.dom,e.props,null);return}let n=e.old?.child??null,o=null,l=0,r=new Map,s=n,c=0;for(;s;){let a=s.fromElement.key??c;r.set(a,{fiber:s,index:c}),s=s.sibling,c++}for(let a=0;a<t.length;a++){let g=t[a],_=g.key??a,I=r.get(_),u=null;if(I){let{fiber:f,index:se}=I;if(r.delete(_),f.type===g.type){if(u=Le(g,e,f),u.didChangePos=a!==se,f.fromElement===g||typeof g.type!="string"&&u.propsCompareFn?.(f.props,g.props)){u.effectTag=3,u.child=f.child;let N=f.child;for(;N;)N.parent=u,N=N.sibling}f.old=null,f.isOld=!0,f.sibling=null,f.parent=null}else C.push(f),u=G(g,e)}else u=G(g,e);u&&(l===0?e.child=u:o.sibling=u,o=u,l++)}r.forEach(({fiber:a})=>C.push(a))}function G(e,t){let n=M();return n.type=e.type,n.parent=t,n.props=e.props,n.fromElement=e,n.effectTag=0,typeof e.type=="string"&&(n.propsCompareFn=j),n}function Le(e,t,n){let o=M();o.type=e.type,o.parent=t,o.old=n,o.dom=n.dom,o.effectTag=1,o.props=e.props,o.version=n.version+1,o.fromElement=e,o.propsCompareFn=n.propsCompareFn;let l=n.stateNode;return l.current=o,o.stateNode=l,o}function Je(e,t){if(e===t)return!0;let n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(let l=0;l<n.length;l++){let r=n[l];if(e[r]!==t[r])return!1}return!0}function L(e,t=Je){function n(o){return e(o)}return n[b]=t,n}var J=e=>Math.round(Math.random()*1e3)%e,oe=["pretty","large","big","small","tall","short","long","handsome","plain","quaint","clean","elegant","easy","angry","crazy","helpful","mushy","odd","unsightly","adorable","important","inexpensive","cheap","expensive","fancy"],re=["red","yellow","blue","green","pink","brown","purple","brown","white","black","orange"],le=["table","chair","house","bbq","desk","car","pony","cookie","sandwich","burger","pizza","mouse","keyboard"],Ue=1,U=e=>{let t=new Array(e);for(let n=0;n<e;n++)t[n]={id:Ue++,label:`${oe[J(oe.length)]} ${re[J(re.length)]} ${le[J(le.length)]}`};return t},_e={data:[],selected:0},Ie=(e,t)=>{let{data:n,selected:o}=e;switch(t.type){case"RUN":return{data:U(1e3),selected:0};case"RUN_LOTS":return{data:U(1e4),selected:0};case"ADD":return{data:n.concat(U(1e3)),selected:o};case"UPDATE":{let r=n.slice(0);for(let s=0;s<r.length;s+=10){let c=r[s];r[s]={id:c.id,label:c.label+" !!!"}}return{data:r,selected:o}}case"CLEAR":return{data:[],selected:0};case"SWAP_ROWS":let l=[...n];if(n.length>998){let r=l[1],s=l[998];l[1]=s,l[998]=r}return{data:l,selected:o};case"REMOVE":{let r=n.findIndex(s=>s.id===t.id);return{data:[...n.slice(0,r),...n.slice(r+1)],selected:o}}case"SELECT":return{data:n,selected:t.id};default:return e}},We=L(({selected:e,item:t,dispatch:n})=>i("tr",{className:e?"danger":""},i("td",{className:"col-md-1"},t.id),i("td",{className:"col-md-4"},i("a",{onClick:H(()=>()=>n({type:"SELECT",id:t.id}),[])},t.label)),i("td",{className:"col-md-1"},i("a",{onClick:H(()=>()=>n({type:"REMOVE",id:t.id}),[])},i("span",{className:"glyphicon glyphicon-remove","aria-hidden":"true"}))),i("td",{className:"col-md-6"})),(e,t)=>e.selected===t.selected&&e.item===t.item),k=({id:e,cb:t,title:n})=>i("div",{className:"col-sm-6 smallpad"},i("button",{type:"button",className:"btn btn-primary btn-block",id:e,onClick:t},n)),Be=L(({dispatch:e})=>i("div",{className:"jumbotron"},i("div",{className:"row"},i("div",{className:"col-md-6"},i("h1",null,"React Hooks keyed")),i("div",{className:"col-md-6"},i("div",{className:"row"},i(k,{id:"run",title:"Create 1,000 rows",cb:()=>e({type:"RUN"})}),i(k,{id:"runlots",title:"Create 10,000 rows",cb:()=>e({type:"RUN_LOTS"})}),i(k,{id:"add",title:"Append 1,000 rows",cb:()=>e({type:"ADD"})}),i(k,{id:"update",title:"Update every 10th row",cb:()=>e({type:"UPDATE"})}),i(k,{id:"clear",title:"Clear",cb:()=>e({type:"CLEAR"})}),i(k,{id:"swaprows",title:"Swap Rows",cb:()=>e({type:"SWAP_ROWS"})}))))),()=>!0),ie=({dispatchRef:e})=>{let[{data:t,selected:n},o]=z(Ie,_e);return e.current=o,i("div",{className:"container"},i(Be,{dispatch:o}),i("table",{className:"table table-hover table-striped test-data"},i("tbody",null,t.map(l=>i(We,{key:l.id,item:l,selected:n===l.id,dispatch:o})))),i("span",{className:"preloadicon glyphicon glyphicon-remove","aria-hidden":"true"}))};var Ve={},qe={createNode:()=>Ve,addProps:()=>{},removeChild:()=>{},replaceWith:()=>{},appendChild:()=>{},insertBefore:()=>{}},p={current:null},Ke=performance.now();ee(void 0,i(ie,{dispatchRef:p}),qe);if(!p.current)throw new Error("dispatch did not bind");p.current({type:"RUN_LOTS"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});p.current({type:"UPDATE"});var Ye=performance.now();console.log(`bench-1k: took ${Ye-Ke} ms`);
